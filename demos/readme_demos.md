Library Demonstration Programs      {#demos}
==============================

The demonstration programs provide examples of the usage of the library for a set of
supported boards. The examples show how to register a system with the library, and then
set-up and extract trace from the system. These programs and associated makefile are provided 
in the `./demos` directory.

Board support is provided for a number of standard ARM platforms:-
- ST-Ericsson Snowball
- ARM Versatile Express Cortex-A15x2+A7x3 ("TC2")
- Juno (ARMv8-A development board), revisions r0 and r1.

Support for other platforms can be created by following the examples above to 
create specific packages for the desired board.

The Example Programs
--------------------

The example programs provided are:-

- `csls`: A simple CoreSight list program that decodes a CoreSight ROM table and lists 
the components found there.
- `cs_etm_config_demo`: A program demonstrating and printing the configuration of an ETM or PTM
component.
- `tracedemo`: A program to capture trace on a running linux system.
- `trace_cti_stop` : This captures trace on the running system in a similar way to tracedemo, but
uses the CTIs channels and triggers to inject a trigger-packet into the trace for each core, control
the trace generated by the cores, and trigger the ETB to flush and halt capture.

These programs can be built on a target system using the supplied  `makefile`.


The Example Source Code
-----------------------

The examples link to both the main CS Access library, and the CS Access Utility library.

The source example files provided are:-

- `cs_demo_known_boards.c` and `cs_demo_known_boards.h` : These files provide a list of known
   hardware boards for use in the demos. This list is passed to the CS Access Utility library 
   `setup_board()` or `setup_named_board()` function.

- `csls.c` : main program source for the csls example.

- `cs_etm_config_demo.c` : main program source for the etm configuration demo.

- `tracedemo.c` : main program source for the trace capture demo.

- `tracedemo_cti_stop.c` : main program to trigger and stop trace capture using CTIs.


Using the Makefile
------------------

Running `make` in the `./demos` directory, or `make` in the project root directory  will build the default release
versions of all the demo programs. These will be created in the `../bin/<arch>/rel` output
directory, relative to `./demos`.
The build process links to the csaccess libraries built into the `../lib/<arch>/rel` directory. 

When built from the project root directory, the demos are built with the same command line options as the main library. 

By default `csls`, `tracedemo`, `etmdemo` and `trace_cti_stop` are built.

Individual programs can be built using the name of the program on the make command line if run in the ./demos directory.
When building individual demos, use the same make command line options as building the CSAL library.

e.g. The following command line builds the debug version of `tracedemo`

    make tracedemo DEBUG=1 



Building and Running the TraceDemo Example
==========================================

This section covers the details for running the TraceDemo example on a supported board.
The set-up procedures here also apply to running any of the other examples on a target system.

Setting up the Example
----------------------

The sources are provided in `[DS-5 install dir]/examples/CoreSight_Access_Library.zip`.

First, import the example into the DS-5 Eclipse workspace as follows:
1. Launch Eclipse for DS-5.
2. Close the Welcome screen, if it appears.
3. From the **File** menu, select **Import...**. The Import wizard opens.
4. Open the **General** folder.
5. Select **Existing Projects into Workspace**
6. Press **Next**
7. Press **Browse...** next to **Select archive file:**. A file dialog opens.
8. Navigate to `[DS-5 install dir]\examples`, select `Coresight_Access_Library.zip`, then press 'OK'.
   The **Projects:** field populates with the project(s) found in the `.zip`.
9. Press **Finish**. The 'Project' view populates with the project(s).

Next, boot Linux on your target, login (preferably as root), and get the IP address of the target using `ifconfig`. 
Then copy the `CoreSight_access` directory from the workspace to a suitable writable directory on your Linux target, 
either using Remote System Explorer as provided in DS-5 or using a secure copy program such as `scp`
(Windows versions of this Linux command are available, such as `pscp` as provided with "Putty").


Configuring the Example for your Target
---------------------------------------

Before you can use the example on your target, you may have to modify some of the source files to suit your target:

- If your target is not one of the platforms already supported, then you will need to add a 
  "registration" function into `cs_demo_known_boards.c`.
  To do this add an entry in the `known_boards[]` array, and write a suitable registration function.
- To configure the range of addresses to be traced in the kernel, open `tracedemo.c` and modify the values of:
  - `KERNEL_TRACE_SIZE` is the extent of the region to trace, and
  - `KERNEL_TRACE_VIRTUAL_ADDR` is the virtual address of the start of the region to trace, i.e. corresponding to addresses in the vmlinux file.
  If not set, it will default to the kernel load address plus 0x50000.

One way to identify the addresses of candidate regions/functions to trace is to use, for example:

    grep cpu_idle /proc/kallsyms

Configuring your Target for the Example
---------------------------------------

Before using the example on your target, check the following:

- For `tracedemo` to use `mmap` to read kernel memory (which it then dumps to a file `kernel_dump.bin` that can be read by DS-5 Debugger), 
  the kernel must have been built without `CONFIG_STRICT_DEVMEM=y`.

  You can check this by typing:

      zgrep "CONFIG_STRICT_DEVMEM" /proc/config.gz

  If the kernel has been built with `CONFIG_STRICT_DEVMEM=y`, then you must either rebuild it with `CONFIG_STRICT_DEVMEM=n` or
  dump the kernel memory manually by some other means, for example, use DS-5 Debugger and DSTREAM to dump this kernel memory 
  from the target (with, for example, the CLI command `dump memory kernel_dump.bin 0xC0008000 +0x50000`), or extract this kernel 
  memory from the kernel Image file.

- For `tracedemo` to use `mmap()` to read kernel memory via `/dev/kmem`, the kernel must have been built with `CONFIG_DEVKMEM=y`.

- To view the disassembly and trace augmented with symbols (e.g. function names), the `vmlinux` file for the kernel must be available, 
  built with debug symbols.  To map the trace and disassembly back to kernel source files, the kernel source tree must also be available.
  
  The `vmlinux` file with debug symbols is created when the kernel is built with debug info (`CONFIG_DEBUG_INFO=y`).  You can check
  how your kernel was built by typing:

      grep "CONFIG_DEBUG_INFO" /proc/config.gz

  If using `make menuconfig` to rebuild the kernel, select the following under 'Kernel Hacking':

      [*] Kernel debugging
          [*] Compile the kernel with debug info

Juno Platform - Additional Configuration when using the CSAL and Demos
----------------------------------------------------------------------
These are additional steps required on Juno systems to ensure correct operation of the CSAL.

The scripts mentioned below are shipped in the `demos/juno_demo_setup` directory.


__Preventing Core Power Down when Idle__

The Juno examples were built and tested on a Juno system that prevented the power down of idle cores.
This was to ensure that all the resources were accessible when the examples were run.

To achieve this:-

1) Create a file with the following contents with a suitable name (e.g. no_cpu_idle.sh).

    #!/bin/sh
    for i in 0 1 2 3 4 5; do
      for j in 0 1 2 ; do
        echo 1 > /sys/devices/system/cpu/cpu$i/cpuidle/state$j/disable;
      done;
    done

This can be run each time the system is booted. Alternatively, the following steps automate the process:-

2) Copy the file into `/etc/init.d/`

3) Run the following command to create an execute on boot link

    ln -s /etc/init.d/YOUR_FILE_NAME  /etc/rc5.d/S99_disable_cpuidle.sh

4) Reboot and confirm that idle is disabled by checking one of the cores (not core0)

    cat /sys/devices/system/cpu/cpu3/cpuidle/state1/disable

See [FAQ: Why am I having problems connecting a debugger to the Juno in DS-5?] (http://community.arm.com/docs/DOC-9320)


__Ensuring Debug Hardware Correctly Powered__

Early Juno system SCP firmware  had no way to power up the CoreSight debug hardware
without a request from an external debugger. This results in a hang when accessing the CoreSight ROM table and
other CoreSight hardware.

This has been corrected using firmware release for Linux kernel 4.9. (16.11 release package).

The workaround is to force a DAP power-up request on the application DAP by briefly attaching an external debug system.

The following script can be used with a DSTREAM connection in the CSAT tool shipped with DS-5 to power the DAPs.

    # Wake DAPS on a Juno system - allow CSAL to access CS debug hardware
    echo Powering Juno DAPs.

    # set the scan chain.
    chain dev=ARMCS-DP,ARMCS-DP

    # connect to first - will force power up
    dvo 0

    # check DP register for power ACK bits
    drr dp.csw

    dvc

    # connect to second - will force power up
    dvo 1

    # check DP register for power ACK bits
    drr dp.csw

    dvc

    echo Done

To use:-

1) Copy the script into a suitable file - e.g. `juno_wake_dap.cst`

2) Connect DSTREAM to your Juno board. Run the CSAT tool and connect to your DSTREAM.

3) On the CSAT command line type

    %> batch juno_wake_dap.cst

4) Disconnect CSAT and DSTREAM.


Running the demonstration example
---------------------------------

Run the `tracedemo` Linux application as root from the `.\bin\rel` directory:

    ./tracedemo

This will auto-detect the target board (if supported), configure trace generation, and retrieve trace 
from the trace buffer.

If the board is not correctly detected then the following command line may be used:

    ./tracedemo -board-name Juno

The name parameter (Juno in this example) must match the `.hardware` structure element 
in the `known_boards[]` array in the `cs_demo_known_boards.c` file. 

To view the possible run options, add "-h" for help:

    ./tracedemo -h

You will see output like:

    Usage:
    -h      This help screen.
    -c <cpu>;        Select CPU for demo to run on. Default 0
    -itm    Enable ITM tracing, ITM tracing disabled by default.
    -full   Show full trace with no filtering.
    -pause  Run the demo with a pause after each step.

If you see: `** csaccess: ERROR: can't open /dev/mem`, then try running it as sudo:

    sudo ./tracedemo

You will see output like (for Snowball):

    root@linaro-ubuntu-desktop:/home/root/CoreSight_access# ./tracedemo
    Default configuration, no CPU affinity selected. ITM disabled.
    CoreSight demonstrator
    ** Currently affine CPUs: #0 #1
    CSDEMO: Detected 'ST-Ericsson Snowball platform' board
    CSDEMO: Registering Snowball CoreSight devices...
    801A4000: 1.2 907 00000000 00/0F type= 7 - SINK BUFFER(8K)
    801A5000: 4.1 906 00040800 00/0F type=10 - CTI
    801A6000: 2.1 908 00000028 00/0F type= 4 - LINK
    801A8000: 5.1 C09 00000000 00/FF type=11 - CPU DEBUG v7 (full CP14) (4 wpt) (6 bkpt) non-Secure auth=AF
    801A9000: 6.1 9A0 00000000 00/FF type=12 - CPU PMU (6 counters) auth=8C
    801AA000: 5.1 C09 00000000 00/FF type=11 - CPU DEBUG v7 (full CP14) (4 wpt) (6 bkpt) non-Secure auth=AF
    801AB000: 6.1 9A0 00000000 00/FF type=12 - CPU PMU (6 counters) auth=8C
    801AC000: 4.1 906 00040800 00/0F type=10 - CTI
    801AD000: 4.1 906 00040800 00/0F type=10 - CTI
    801AE000: 3.1 950 00000000 00/FF type= 1 - CPU SOURCE PTMv1.0
    801AF000: 3.1 950 00000000 00/FF type= 1 - CPU SOURCE PTMv1.0
    CSDEMO: Registering CPU affinities...
    CSDEMO: Registering trace-bus connections...
    CSDEMO: Registration complete.
    CSDEMO: Configuring trace...
    CSDEMO: Configuring trace source id for CPU #0 ETM/PTM...
    CSDEMO: Initialising ETM/PTM
    ** 801AE000: write 030 (off) = 0000406F now 00000000
    ** 801AE000: write 150 (off) = 00000000 now 00020000
    CSDEMO: Configuring trace source id for CPU #1 ETM/PTM...
    CSDEMO: Initialising ETM/PTM
    ** 801AF000: write 030 (off) = 0000406F now 00000000
    ** 801AF000: write 150 (off) = 00000000 now 00020000
    ETM static configuration:
      ETMCCR = 8D294004
      ETMCCER = 000008EA
      ETMSCR = 00000000
      ETMIDR = 411CF301
    ETM dynamic configuration:
      ETMCR = 00000000
      Trace enable event: true
      Trace enable control: CR1=00000001 CR2=00000000
      Trace start comparators: 0000
      Trace stop comparators: 0000
      Counters: 2
        #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
        #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
      Address comparators: 8
        #0: address=C0008000 type=00000019 (execute) (size=4) (S:all) (NS:all)
        #1: address=C0058000 type=00000019 (execute) (size=4) (S:all) (NS:all)
      Sequencer present: 1
      Sequencer:
        Current state: 1
        1 -> 2: single-addr-comp-0
        1 -> 3: false
        2 -> 1: false
        2 -> 3: single-addr-comp-1
        3 -> 1: false
        3 -> 2: false
    ** 801AE000: write 080 (CS_ETMACTR(i)) = 00000019 now 00000001
    ** 801AE000: write 084 (CS_ETMACTR(i)) = 00000019 now 00000001
    CSDEMO: Reading back configuration after programming...
    ETM static configuration:
      ETMCCR = 8D294004
      ETMCCER = 000008EA
      ETMSCR = 00000000
      ETMIDR = 411CF301
    ETM dynamic configuration:
      ETMCR = 00000400
      Cycle accurate: 0
      Branch output: 0
      Timestamp enabled: 0
      CONTEXTID size: 0 bytes
      Trace enable event: true
      Trace enable control: CR1=00000001 CR2=00000000
      Trace start comparators: 0000
      Trace stop comparators: 0000
      Trigger event: false
      Counters: 2
        #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
        #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
      Address comparators: 8
        #0: address=C0008000 type=00000001 (execute) (size=1) (S:all) (NS:all)
        #1: address=C0058000 type=00000001 (execute) (size=1) (S:all) (NS:all)
        #2: address=6D7C9CB5 type=00000E01 (execute) (size=1) (S:none) (NS:none)
        #3: address=59425D80 type=00000C01 (execute) (size=1) (S:none) (NS:none)
        #4: address=FC1B425D type=00000401 (execute) (size=1) (S:none) (NS:all)
        #5: address=C085D159 type=00000B01 (execute) (size=1) (S:all) (NS:none)
        #6: address=CF79EACF type=00000801 (execute) (size=1) (S:all) (NS:none)
        #7: address=AB4DF605 type=00000B01 (execute) (size=1) (S:all) (NS:none)
      Data comparators: 0
      Sequencer present: 1
      Sequencer:
        Current state: 1
        1 -> 2: single-addr-comp-0
        1 -> 3: false
        2 -> 1: false
        2 -> 3: single-addr-comp-1
        3 -> 1: false
        3 -> 2: false
      CONTEXTID comparators: 1
        Mask: FFFFFFFF
        #0: contextid: 00000000
      External outputs:
        #0: false
        #1: false
    ETM static configuration:
      ETMCCR = 8D294004
      ETMCCER = 000008EA
      ETMSCR = 00000000
      ETMIDR = 411CF301
    ETM dynamic configuration:
      ETMCR = 00000000
      Trace enable event: true
      Trace enable control: CR1=00000001 CR2=00000000
      Trace start comparators: 0000
      Trace stop comparators: 0000
      Counters: 2
        #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
        #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
      Address comparators: 8
        #0: address=C0008000 type=00000019 (execute) (size=4) (S:all) (NS:all)
        #1: address=C0058000 type=00000019 (execute) (size=4) (S:all) (NS:all)
      Sequencer present: 1
      Sequencer:
        Current state: 1
        1 -> 2: single-addr-comp-0
        1 -> 3: false
        2 -> 1: false
        2 -> 3: single-addr-comp-1
        3 -> 1: false
        3 -> 2: false
    ** 801AF000: write 080 (CS_ETMACTR(i)) = 00000019 now 00000001
    ** 801AF000: write 084 (CS_ETMACTR(i)) = 00000019 now 00000001
    CSDEMO: Reading back configuration after programming...
    ETM static configuration:
      ETMCCR = 8D294004
      ETMCCER = 000008EA
      ETMSCR = 00000000
      ETMIDR = 411CF301
    ETM dynamic configuration:
      ETMCR = 00000400
      Cycle accurate: 0
      Branch output: 0
      Timestamp enabled: 0
      CONTEXTID size: 0 bytes
      Trace enable event: true
      Trace enable control: CR1=00000001 CR2=00000000
      Trace start comparators: 0000
      Trace stop comparators: 0000
      Trigger event: false
      Counters: 2
        #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
        #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
      Address comparators: 8
        #0: address=C0008000 type=00000001 (execute) (size=1) (S:all) (NS:all)
        #1: address=C0058000 type=00000001 (execute) (size=1) (S:all) (NS:all)
        #2: address=B277380E type=00000D01 (execute) (size=1) (S:none) (NS:none)
        #3: address=E8FF4E39 type=00000D01 (execute) (size=1) (S:none) (NS:none)
        #4: address=989EAE80 type=00000801 (execute) (size=1) (S:all) (NS:none)
        #5: address=45FB31E5 type=00000F01 (execute) (size=1) (S:none) (NS:none)
        #6: address=E5F180E4 type=00000C01 (execute) (size=1) (S:none) (NS:none)
        #7: address=B6FD1362 type=00000301 (execute) (size=1) (S:all) (NS:all)
      Data comparators: 0
      Sequencer present: 1
      Sequencer:
        Current state: 1
        1 -> 2: single-addr-comp-0
        1 -> 3: false
        2 -> 1: false
        2 -> 3: single-addr-comp-1
        3 -> 1: false
        3 -> 2: false
      CONTEXTID comparators: 1
        Mask: FFFFFFFF
        #0: contextid: 00000000
      External outputs:
        #0: false
        #1: false
    CSDEMO: Enabling trace...
    CSDEMO: Configured and enabled trace.
    CSDEMO: Trace configured
    CSDEMO: Created trace configuration export files
    CSDEMO: trace buffer contents: 8192 bytes
    [press RETURN to stop tracing or q/Q to quit]
    CSDEMO: Disable trace...
    CSDEMO: trace buffer contents: 8192 bytes
    ETM static configuration:
      ETMCCR = 8D294004
      ETMCCER = 000008EA
      ETMSCR = 00000000
      ETMIDR = 411CF301
    ETM dynamic configuration:
      ETMCR = 10001400
      Cycle accurate: 1
      Branch output: 0
      Timestamp enabled: 1
      CONTEXTID size: 0 bytes
      Trace enable event: true
      Trace enable control: CR1=00000001 CR2=00000000
      Trace start comparators: 0000
      Trace stop comparators: 0000
      Trigger event: false
      Counters: 2
        #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
        #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
      Address comparators: 8
        #0: address=C0008000 type=00000001 (execute) (size=1) (S:all) (NS:all)
        #1: address=C0058000 type=00000001 (execute) (size=1) (S:all) (NS:all)
        #2: address=6D7C9CB5 type=00000E01 (execute) (size=1) (S:none) (NS:none)
        #3: address=59425D80 type=00000C01 (execute) (size=1) (S:none) (NS:none)
        #4: address=FC1B425D type=00000401 (execute) (size=1) (S:none) (NS:all)
        #5: address=C085D159 type=00000B01 (execute) (size=1) (S:all) (NS:none)
        #6: address=CF79EACF type=00000801 (execute) (size=1) (S:all) (NS:none)
        #7: address=AB4DF605 type=00000B01 (execute) (size=1) (S:all) (NS:none)
      Data comparators: 0
      Sequencer present: 1
      Sequencer:
        Current state: 1
        1 -> 2: single-addr-comp-0
        1 -> 3: false
        2 -> 1: false
        2 -> 3: single-addr-comp-1
        3 -> 1: false
        3 -> 2: false
      CONTEXTID comparators: 1
        Mask: FFFFFFFF
        #0: contextid: 00000000
      External outputs:
        #0: false
        #1: false
    ETM static configuration:
      ETMCCR = 8D294004
      ETMCCER = 000008EA
      ETMSCR = 00000000
      ETMIDR = 411CF301
    ETM dynamic configuration:
      ETMCR = 10001400
      Cycle accurate: 1
      Branch output: 0
      Timestamp enabled: 1
      CONTEXTID size: 0 bytes
      Trace enable event: true
      Trace enable control: CR1=00000001 CR2=00000000
      Trace start comparators: 0000
      Trace stop comparators: 0000
      Trigger event: false
      Counters: 2
        #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
        #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
      Address comparators: 8
        #0: address=C0008000 type=00000001 (execute) (size=1) (S:all) (NS:all)
        #1: address=C0058000 type=00000001 (execute) (size=1) (S:all) (NS:all)
        #2: address=B277380E type=00000D01 (execute) (size=1) (S:none) (NS:none)
        #3: address=E8FF4E39 type=00000D01 (execute) (size=1) (S:none) (NS:none)
        #4: address=989EAE80 type=00000801 (execute) (size=1) (S:all) (NS:none)
        #5: address=45FB31E5 type=00000F01 (execute) (size=1) (S:none) (NS:none)
        #6: address=E5F180E4 type=00000C01 (execute) (size=1) (S:none) (NS:none)
        #7: address=B6FD1362 type=00000301 (execute) (size=1) (S:all) (NS:all)
      Data comparators: 0
      Sequencer present: 1
      Sequencer:
        Current state: 1
        1 -> 2: single-addr-comp-0
        1 -> 3: false
        2 -> 1: false
        2 -> 3: single-addr-comp-1
        3 -> 1: false
        3 -> 2: false
      CONTEXTID comparators: 1
        Mask: FFFFFFFF
        #0: contextid: 00000000
      External outputs:
        #0: false
        #1: false
    CSDEMO: Fetching trace from core ETB:
      Buffer RAM size: 8192
      Bytes to read in buffer: 8192
      Buffer has wrapped: 1
    ** 8192 bytes of trace
    The first 256 bytes of trace are:
     80 01 AE D3 8E 01 4C 01 08 90 58 01 C0 29 CC 02  0C CA 00 9F FA 0C 48 01 08 E0 66 01 C0 29 EC 27
     A0 01 E6 C1 0E 68 02 08 9C 68 00 C0 28 D0 04 E6  AA D8 14 40 00 08 00 17 02 C0 28 CC 02 CC 02 65
     BE D8 14 60 00 08 A8 0C 00 C0 28 F4 02 AC F2 35  0C AE 88 08 94 89 02 C0 28 E8 02 AC A8 08 C4 38
     88 03 C0 29 DC 0B D6 8C 02 50 00 A9 84 01 70 69  00 F0 23 01 A0 FD 00 7C 00 C6 00 FB 8E 02 78 3D
     00 ED 18 6C 00 A4 EA 01 A0 E8 00 AC 08 74 18 25  00 C0 28 FC 08 A4 08 E0 66 01 C0 29 E0 AF 00 97
     E6 C1 0E 54 00 08 78 18 00 C0 28 C8 0C B4 08 37  E8 00 00 C0 28 FC 5A C4 02 08 BC 97 00 C0 28 9E
     F0 06 E2 18 58 01 F8 01 E4 03 EE AB 0A 28 08 62  0C 01 00 C0 28 E8 06 91 9E D1 00 1C 08 DC 48 BE
     04 C0 28 C8 BE 02 C4 05 08 FC 48 05 C0 29 DC 27  04 9C 98 0A 78 03 23 D3 D8 24 14 08 DC 49 04 8A
    CSDEMO: shutdown...

Depending on the configuration, `tracedemo` creates a number of output files such as `snapshot.ini`, `cpu_0.ini`, `cpu_1.ini`, 
`device_2.ini`, `device_3.ini`, `trace.ini`, `kernel_dump.bin` and `cstrace.bin`.  These files can be loaded into DS-5 Debugger to analyze
the collected trace, as described in the next section.

Copy these files from the target into a suitable writable directory on your host, either using Remote System Explorer in DS-5
 or `scp` (or `pscp` on Windows).

To create a standalone package of files for decoding by DS-5 Debugger, for example to give to someone else, collect the files above, 
together with `vmlinux`, and the kernel source tree.

Analyzing the collected trace in DS-5 (v5.21 onwards)
----------------------------------------------------

The files created by `tracedemo`, after copying to the host, can be loaded into DS-5 Debugger to analyze the collected trace as follows:  

1. Launch Eclipse for DS-5.
2. From the **Window** menu, select **Perspective** -> **Open Perspective** -> **DS-5 Debug**.
3. From the **Run** menu, select **Debug Configurations...**.
4. In the **Debug Configurations** dialog, open the **DS-5 Debugger** node.
5. Create a new debug configuration and give it a name.
6. In the **Debugger** tab click the **Connect only** radio button.
7. In the **Connection** tab tree view, open the **Generic** platform, then select **SnapShot** -> **View Snapshot** -> **View Snapshot**.
8. In the Connection field below, enter the path to the top-level snapshot contents file `snapshot.ini`.
   You can use the **File...** button to navigate to the file.
   
   To load the ready-made example files, specify e.g. 

   `.../DS-5 Workspace/CoreSight_access/example_captures/Snowball/snapshot.ini`.
9. To view the disassembly and trace augmented with symbols (e.g. function names), the `vmlinux` file for the kernel must be given.

   In the **Files** tab, select **Load symbols from file**, and use the **File System...** or **Workspace...** buttons to navigate to the `vmlinux` file.
   
10. In cases where the kernel modifies itself, you can force DS-5 Debugger to use program code from `kernel_dump.bin` rather than `vmlinux`.  

   In the **Debugger** tab, tick **Execute debugger commands**, and add `set trust-ro-sections-for-opcodes off` to its field

11. Press **Debug**.

Ready-made example files captured from a session on a Snowball (ARMv7-A) target, an ARM TC2 (ARMv7-A) and a Juno (ARMv8-A) target are provided
in the `./example_captures/Snowball`, `./example_captures/TC2` and `./example_captures/Juno` directories that can be 
used for test or demo purposes.  Ready-made debug config launch files `Generic-Snapshot-<platform>.launch` are 
also provided for each of the above ready made captures.

Known issues and troubleshooting
--------------------------------

- If you see: `** csaccess: ERROR: can't open /dev/mem`, then try running `tracedemo` as either root or sudo:

      sudo ./tracedemo

- If you see:
      
      Unable to connect to snapshot.ini
      Unable to configure connection to system specified in configuration file
      Couldn't find size of 'kernel_dump.bin' - perhaps the file is missing or unreadable

  then `kernel_dump.bin` is missing or unreadable.  (Re-)create `kernel_dump.bin` as described earlier.
